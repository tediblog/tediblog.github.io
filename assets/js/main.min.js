/*

Script has been made by @load0 (discord: load0) (github: load-dev)
- Specially made for this website (TediBlog)
- Please do not copy this script without permission

*/
document.getElementById('menu-button').addEventListener('click', function() {
    var menu = document.getElementById('mobile-menu');
    if (menu.classList.contains('hidden')) {
        menu.classList.remove('hidden');
        menu.classList.add('block');
        document.addEventListener('click', closeMenuOnOutsideClick);
    } else {
        menu.classList.remove('block');
        menu.classList.add('hidden');
        document.removeEventListener('click', closeMenuOnOutsideClick);
    }
});

const navLinks = document.querySelectorAll('.nav-link');
const mnavLinks = document.querySelectorAll('.mnav-link');
let currentTab = localStorage.getItem('currentTab') || 'home';

function setActiveTab(tabId) {
    navLinks.forEach(link => {
        link.classList.remove('text-blue-500', 'font-bold');
        link.classList.add('text-gray-800', 'font-medium');
        link.classList.add('hover-animate');
    });

    mnavLinks.forEach(link => {
        link.classList.remove('text-blue-500', 'font-bold');
        link.classList.add('text-gray-800', 'font-medium');
    })

    const activeLink = document.getElementById(tabId);
    if (activeLink) {
        if (window.innerWidth <= 768) { // If in mobile view
            activeLink.classList.remove('text-gray-800', 'font-medium');
            activeLink.classList.add('text-blue-500', 'font-bold');
        } else {
            activeLink.classList.remove('text-gray-800', 'font-medium');
            activeLink.classList.add('text-blue-500', 'font-bold');
            activeLink.classList.remove('hover-animate');
        }
    }
}

let isInitialLoad = true;

function loadTabContent(tab) {
    if (tab === currentTab && !isInitialLoad) {
        return;
    }
    isInitialLoad = false;
    currentTab = tab;
    const contentDiv = document.getElementById('content');
    contentDiv.innerHTML = '';
    switch(tab) {
        case 'home':
            contentDiv.innerHTML = `
                <img src="/assets/img/logo.png" alt="Logo" class="mx-auto h-24 w-24 animate-fadeInUp">
                <h1 class="mt-4 text-4xl font-bold text-white animate-fadeInUpDelayed02">TediBlog</h1>
                <p class="mt-2 text-lg text-white animate-fadeInUpDelayed03">Self-hosted customizable blog website</p>
                <div class="mt-6 flex flex-col md:flex-row space-y-4 md:space-y-0 md:space-x-4 animate-fadeInUpDelayed05">
                    <button class="hover-animate bg-white text-gray-800 font-semibold py-2 px-4 rounded inline-flex items-center w-48 mx-auto md:mx-0 justify-center" onclick='redirect("gh")'>
                        <i class='bx bxl-github'></i>
                        <span class="ml-2">GitHub</span>
                    </button>
                    <button class="hover-animate bg-white text-gray-800 font-semibold py-2 px-4 rounded inline-flex items-center w-48 mx-auto md:mx-0 justify-center" onclick='redirect("dw")'>
                        <i class='bx bx-download'></i>
                        <span class="ml-2">Download</span>
                    </button>
                    <button class="hover-animate bg-white text-gray-800 font-semibold py-2 px-4 rounded inline-flex items-center w-48 mx-auto md:mx-0 justify-center" onclick='redirect("dc")'>
                        <i class='bx bx-book'></i>
                        <span class="ml-2">Documentation</span>
                    </button>
                </div>
            `;
            break;
        case 'documentation':
            contentDiv.innerHTML = `<p class="mt-4 text-4xl font-bold text-white">Loading...</p>
            <button class="mt-6 hover-animate bg-white text-gray-800 font-semibold py-2 px-4 rounded animate-fadeInUpDelayed02"><a href="https://tediblog.gitbook.io/main">Click to redirect manually</a></button>
            <button class="mt-6 hover-animate bg-white text-gray-800 font-semibold py-2 px-4 rounded animate-fadeInUpDelayed02" onclick='goBack()'>Go Back Home</button>
            `;
            redirect("dc");
            break;
        case 'discord':
            contentDiv.innerHTML = `<p class="mt-4 text-4xl font-bold text-white animate-fadeInUp">Discord is coming soon!</p>
            <button class="mt-6 hover-animate bg-white text-gray-800 font-semibold py-2 px-4 rounded animate-fadeInUpDelayed02" onclick='goBack()'>Go Back</button>
            `;
            break;
        case 'photos':
            contentDiv.innerHTML = `
                <div class="mt-4 text-4xl font-bold text-white animate-fadeInUp">Photos are coming soon!</div>
                <div class="mt-4 text-3xl text-white animate-fadeInUp">Join our <a href="?page=discord" class="text-blue-300">Discord server</a> for more info</div>
                <button class="mt-6 hover-animate bg-white text-gray-800 font-semibold py-2 px-4 rounded animate-fadeInUpDelayed02" onclick='goBack()'>Go Back</button>
            `;
            break;
        case 'demo':
            contentDiv.innerHTML = `
                <div class="mt-4 text-4xl font-bold text-white animate-fadeInUp">Demo is coming soon!</div>
                <div class="mt-4 text-3xl text-white animate-fadeInUp">Join our <a href="?page=discord" class="text-blue-300">Discord server</a> for more info</div>
                <button class="mt-6 hover-animate bg-white text-gray-800 font-semibold py-2 px-4 rounded animate-fadeInUpDelayed02" onclick='goBack()'>Go Back</button>
            `;
            break;
        case 'download':
            contentDiv.innerHTML = `
                <div class="mt-4 text-4xl font-bold text-white animate-fadeInUp">Download is not available yet!</div>
                <div class="mt-4 text-3xl text-white animate-fadeInUp">Join our <a href="?page=discord" class="text-blue-300">Discord server</a> for more info</div>
                <button class="mt-6 hover-animate bg-white text-gray-800 font-semibold py-2 px-4 rounded animate-fadeInUpDelayed02" onclick='goBack()'>Go Back</button>
            `;
            break;
        case '404':
            contentDiv.innerHTML = `
                <div class="mt-4 text-4xl font-bold text-white animate-fadeInUp">404 - Page Not Found</div>
                <button class="mt-6 hover-animate bg-white text-gray-800 font-semibold py-2 px-4 rounded animate-fadeInUpDelayed02" onclick='goBack()'>Go Back</button>
            `;
            break;
        default:
            contentDiv.innerHTML = `
                <div class="mt-4 text-4xl font-bold text-white animate-fadeInUp">500 - Server error</div>
                <div class="mt-4 text-3xl text-white animate-fadeInUp">Something went wrong on our side. Please reload the page or click the Go Back button</div>
                <button class="mt-6 hover-animate bg-white text-gray-800 font-semibold py-2 px-4 rounded animate-fadeInUpDelayed02" onclick='goBack()'>Go Back</button>
            `;
            break;
    }
}

function redirect(to) {
    if (to === "gh") {
        window.location.href = "https://github.com/tediblog";
    } else if (to === "dw") {
        localStorage.setItem('currentTab', 'download');
        setActiveTab('nav-download');
        loadTabContent('download');
    } else if (to === "dc") {
        window.location.href = "https://tediblog.gitbook.io/main";
    }
}

function goBack() {
    localStorage.setItem('currentTab', 'home');
    setActiveTab('nav-home');
    loadTabContent('home');
}

function getParameterByName(name, url = window.location.href) {
    name = name.replace(/[\[\]]/g, '\\$&');
    const regex = new RegExp('[?&]' + name + '(=([^&#]*)|&|#|$)');
    const results = regex.exec(url);
    if (!results) return null;
    if (!results[2]) return '';
    return decodeURIComponent(results[2].replace(/\+/g, ' '));
}

function closeMenuOnOutsideClick(event) {
    const menu = document.getElementById('mobile-menu');
    const menuButton = document.getElementById('menu-button');
    if (!menu.contains(event.target) && !menuButton.contains(event.target)) {
        menu.classList.remove('block');
        menu.classList.add('hidden');
        document.removeEventListener('click', closeMenuOnOutsideClick);
    }
}

function init() {
    const validTabs = ['home', 'documentation', 'discord', 'photos', 'demo', 'download'];
    const pageParam = getParameterByName('page');
    currentTab = pageParam ? pageParam : localStorage.getItem('currentTab') || 'home';

    if (!validTabs.includes(currentTab)) {
        currentTab = '404';
        localStorage.setItem('currentTab', '404');
    }

    if (currentTab==="documentation") {
        localStorage.setItem('currentTab', "home");
        loadTabContent("home")
    } else {
        setActiveTab('nav-' + currentTab);
        loadTabContent(currentTab);
        localStorage.setItem('currentTab', currentTab);
    }


    navLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const tab = link.id.replace('nav-', '');
            if (tab !== currentTab) {
                localStorage.setItem('currentTab', tab);
                setActiveTab(link.id);
                loadTabContent(tab);
                if (window.innerWidth <= 768) { // If in mobile view
                    document.getElementById('mobile-menu').classList.remove('block');
                    document.getElementById('mobile-menu').classList.add('hidden');
                }
            }
        });
    });

    mnavLinks.forEach(link => {
        link.addEventListener('click', (e) => {
            e.preventDefault();
            const tab = link.id.replace('mnav-', '');
            if (tab !== currentTab) {
                localStorage.setItem('currentTab', tab);
                setActiveTab(link.id);
                loadTabContent(tab);
                if (window.innerWidth <= 768) { // If in mobile view
                    document.getElementById('mobile-menu').classList.remove('block');
                    document.getElementById('mobile-menu').classList.add('hidden');
                }
            }
        });
    });

    document.querySelector('a[href="/"]').addEventListener('click', (e) => {
        e.preventDefault();
        localStorage.setItem('currentTab', 'home');
        setActiveTab('nav-home');
        loadTabContent('home');
    });

    if (pageParam) {
        window.history.replaceState({}, document.title, "/");
    }
}

document.addEventListener('DOMContentLoaded', init);
